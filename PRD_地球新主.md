# 产品需求文档 (PRD)
## 地球新主 - EarthLord

---

## 1. 文档信息

| 项目 | 内容 |
|------|------|
| 产品名称 | 地球新主 (EarthLord) |
| 版本 | 1.0 |
| 文档版本 | v1.0 |
| 创建日期 | 2025-12-27 |
| 平台 | iOS |

---

## 2. 产品概述

### 2.1 产品定位
地球新主是一款**LBS（基于位置服务）生存类手机游戏**，融合了真实世界地理位置、末日生存、领地经营和社交元素。玩家通过真实行走在现实世界中圈定领地、探索废墟、收集资源、建造设施，并与其他玩家进行交易和社交互动。

### 2.2 核心价值主张
- **Walk to Earn**: 通过真实行走获得游戏奖励，促进用户运动健康
- **真实世界映射**: 将现实地理位置与游戏世界结合，增强沉浸感
- **末日生存体验**: 在"希望朋克"风格的末日世界中重建文明
- **社交互动**: 基于位置的玩家交易和通讯系统

### 2.3 目标用户
| 用户群体 | 特征描述 |
|----------|----------|
| 核心用户 | 18-35岁，喜欢户外运动和生存游戏的玩家 |
| 次要用户 | 对AR/LBS游戏感兴趣的用户（如宝可梦GO玩家） |
| 潜在用户 | 希望通过游戏化方式增加运动量的用户 |

### 2.4 市场定位
- 对标产品：Pokemon GO、Ingress、Orna
- 差异化：末日生存主题 + 领地经营 + 以物易物交易系统

---

## 3. 产品目标

### 3.1 商业目标
- **用户增长**: 上线首年达到10万注册用户
- **用户留存**: 次日留存率 > 40%，7日留存率 > 20%
- **商业变现**: 通过订阅制和内购实现盈利

### 3.2 用户目标
- 获得有趣的户外游戏体验
- 通过游戏增加日常运动量
- 在虚拟世界中获得成就感和社交满足

---

## 4. 功能需求

### 4.1 核心循环
```
登录注册 → 圈地占领 → 探索搜刮 → 获得资源
    ↑                              ↓
    │         建造建筑（消耗资源）
    │         交易换物（流通资源）
    │         生存消耗（食物/水）
    │                              ↓
    └──────── 通讯社交 ← 成就排行 ← 发展壮大
```

### 4.2 功能模块总览

| 模块 | 功能 | 优先级 |
|------|------|--------|
| 第一部分 | 登录与圈地系统 | P0 |
| 第二部分 | 探索与资源获取 | P0 |
| 第三部分 | 建造与交易系统 | P0 |
| 第四部分 | 通讯系统 | P1 |
| 第五部分 | 个人中心与商业化 | P1 |

---

## 5. 详细功能需求

### 5.1 第一部分：登录与圈地系统

#### 5.1.1 登录注册系统
**需求描述**: 用户需要创建账号并登录才能开始游戏

**功能要求**:
| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 邮箱注册 | 支持邮箱+密码注册 | P0 |
| Apple登录 | 支持Apple ID一键登录 | P0 |
| Google登录 | 支持Google账号登录 | P0 |
| 会话管理 | 保持登录状态，支持多设备 | P0 |
| 密码重置 | 支持邮箱找回密码 | P1 |

**技术方案**: Supabase Auth

**验收标准**:
- 用户可通过三种方式成功注册/登录
- 登录状态在App重启后保持
- 登录失败有明确错误提示

---

#### 5.1.2 GPS圈地系统
**需求描述**: 玩家通过真实行走，使用GPS轨迹圈定属于自己的领地

**功能要求**:
| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| GPS追踪 | 实时追踪用户位置移动 | P0 |
| 轨迹绘制 | 在地图上绘制用户行走轨迹（蓝色线条） | P0 |
| 多边形闭合 | 返回起点附近时自动闭合形成多边形 | P0 |
| 面积计算 | 计算圈定区域的面积 | P0 |
| 合法性校验 | 检查是否与其他领地重叠、是否作弊 | P0 |
| 领地确认 | 校验通过后确认领地归属 | P0 |

**业务规则**:
- 圈地最小面积：100m²
- 圈地最大面积：无上限（根据订阅等级）
- 起点终点容差：10米以内自动闭合
- 领地不可与已存在的其他玩家领地重叠

**技术方案**:
- 地图：Apple MapKit（免费、全球可用）
- 地理数据：PostGIS

**验收标准**:
- GPS定位精度 < 10米
- 轨迹绘制流畅无延迟
- 面积计算准确
- 重叠检测可靠

---

#### 5.1.3 领地管理
**需求描述**: 玩家可以查看和管理自己的领地

**功能要求**:
| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 领地列表 | 显示玩家拥有的所有领地 | P0 |
| 领地命名 | 给领地起名字 | P1 |
| 领地详情 | 显示面积、建筑数量等信息 | P0 |
| 交易开关 | 设置是否允许其他玩家交易 | P1 |

**业务规则**:
- 玩家进入领地100米范围内可看到该领地的交易挂单
- 领地需在30天内开始建设，90天内保持活跃

---

### 5.2 第二部分：探索与资源获取

#### 5.2.1 POI发现与搜刮
**需求描述**: 玩家走到真实世界的POI（兴趣点）附近，可以搜刮获得资源

**功能要求**:
| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| POI显示 | 在地图上显示附近的真实POI | P0 |
| POI发现 | 玩家进入POI范围时提示发现 | P0 |
| 资源搜刮 | 在POI处进行搜刮获得物资 | P0 |
| 探索统计 | 记录探索距离和时长 | P1 |

**POI类型与资源对应**:
| POI类型 | 产出资源 |
|---------|----------|
| 医院、药店 | 药品（急救包、抗生素） |
| 超市、餐厅 | 食物（罐头、饮用水） |
| 工厂、工地 | 金属材料 |
| 公园、林地 | 木材 |
| 银行、珠宝店 | 稀有材料 |

**技术方案**:
- POI数据：Apple MapKit（免费）
- 地理围栏触发

**验收标准**:
- POI显示与真实世界一致
- 进入POI范围50米内触发发现
- 资源产出符合POI类型

---

#### 5.2.2 背包系统
**需求描述**: 管理玩家收集到的所有物资

**功能要求**:
| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 物品存储 | 存放搜刮获得的物品 | P0 |
| 容量限制 | 背包有容量上限 | P0 |
| 物品分类 | 按类型筛选物品 | P1 |
| 物品使用 | 使用消耗类物品 | P0 |
| 本地优先 | 离线可用，联网同步 | P1 |

**业务规则**:
- 初始背包容量：100格
- 可通过建造仓库扩容

---

### 5.3 第三部分：建造与交易系统

#### 5.3.1 建造系统
**需求描述**: 玩家消耗资源在领地上建造各种建筑

**功能要求**:
| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 建筑菜单 | 浏览可建造的建筑 | P0 |
| 资源检查 | 检查资源是否足够 | P0 |
| 建筑放置 | 选择建筑位置 | P0 |
| 建造确认 | 扣除资源，开始建造 | P0 |

**建筑分类**:
| 类别 | 建筑示例 |
|------|----------|
| 生存类 | 篝火、庇护所 |
| 储存类 | 小仓库、中仓库 |
| 生产类 | 农田、工作台 |
| 能源类 | 太阳能板、风力发电机 |

**建筑等级**: Tier 1（生存基础）→ Tier 2（功能扩展）→ Tier 3（高级设施）

---

#### 5.3.2 建筑状态管理
**需求描述**: 建筑有不同状态，需要维护和升级

**建筑状态**:
| 状态 | 描述 | 可用操作 |
|------|------|----------|
| 建造中 | 正在施工 | 等待 |
| 待激活 | 建好未启用 | 激活 |
| 运行中 | 正常工作 | 升级、停用 |
| 损坏 | 需要维修 | 维修 |

---

#### 5.3.3 交易系统
**需求描述**: 玩家之间进行以物易物的交易

**功能要求**:
| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 发布挂单 | 发布"我提供X换取Y"的交易 | P0 |
| 浏览挂单 | 查看附近可用的交易 | P0 |
| 接受交易 | 接受他人的交易请求 | P0 |
| 交易记录 | 查看历史交易 | P1 |

**业务规则**:
- 需在对方领地100米范围内才能看到挂单
- 交易为以物易物，不涉及货币

---

### 5.4 第四部分：通讯系统

#### 5.4.1 消息中心
**需求描述**: 接收系统推送消息

**消息类型**:
- 生存指南（教程）
- 每日任务
- 官方公告

---

#### 5.4.2 公共频道聊天
**需求描述**: 基于位置的公共聊天室

**功能要求**:
| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 区域聊天 | 覆盖范围3km的公共频道 | P0 |
| 实时消息 | 消息秒级送达 | P0 |
| 消息记录 | 保存聊天历史 | P1 |

**技术方案**: Supabase Realtime

---

#### 5.4.3 频道管理
**需求描述**: 创建和加入私人频道（类似群组）

**功能要求**:
- 创建频道
- 加入/退出频道
- 频道内聊天
- 查看频道列表

---

#### 5.4.4 PTT呼叫
**需求描述**: 模拟对讲机的语音呼叫功能

**功能要求**:
- 长按说话，松开发送
- 实时语音传输
- 显示当前频率

---

#### 5.4.5 通讯设备等级
**需求描述**: 通讯能力随设备升级提升

**设备等级**:
| 设备 | 能力 | 范围 |
|------|------|------|
| 收音机 | 只能接收 | - |
| 对讲机 | 收发 | 3km |
| 营地电台 | 收发 | 10km |
| 卫星通讯 | 收发 | 全球 |

---

### 5.5 第五部分：个人中心与商业化

#### 5.5.1 个人主页
**功能要求**:
- 显示幸存者等级
- 存活天数
- 领地数量和总面积
- 建筑数量

---

#### 5.5.2 多语言设置
**支持语言**:
- 简体中文
- 繁体中文
- English

---

#### 5.5.3 付费订阅系统
**订阅方案**:
| 方案 | 价格 | 权益 |
|------|------|------|
| 开拓者月卡 | $9.99/月 | 无限探索、范围扩大 |
| 领主通行证 | $19.99/月 | 所有特权 |

**资源包（一次性购买）**:
| 资源包 | 价格 |
|--------|------|
| 初级物资包 | $0.99 |
| 中级物资包 | $2.99 |
| 稀有资源包 | $9.99 |

**技术方案**: StoreKit 2

---

#### 5.5.4 排行榜
**榜单类型**:
- 领地面积榜
- 探索废墟榜
- 建筑数量榜

**技术要求**:
- 支持10万用户秒级查询
- 5分钟更新一次

---

#### 5.5.5 成就系统
**成就分类**:
- 新手成就：引导熟悉游戏
- 进阶成就：挑战目标
- 稀有成就：高难度完成

**成就稀有度**: 普通 → 稀有 → 史诗 → 传说

**技术方案**: EventBus（事件总线）

---

#### 5.5.6 生存体征
**需求描述**: 角色需要维持生存状态

**体征指标**:
| 指标 | 衰减速度 | 影响 |
|------|----------|------|
| 核心生命 | 依赖饱食/水分 | 降到0则死亡 |
| 饱食度 | -5%/小时 | 低于阈值掉血 |
| 水分 | -10%/小时 | 低于阈值掉血 |

**增益机制**: 饱食度/水分 > 80% 时获得效率增益

---

## 6. 非功能需求

### 6.1 性能要求
| 指标 | 要求 |
|------|------|
| GPS定位精度 | < 10米 |
| 地图加载时间 | < 2秒 |
| 消息送达延迟 | < 1秒 |
| 排行榜查询 | < 500ms |

### 6.2 可用性要求
- 支持离线使用基本功能（背包查看、地图缓存）
- 网络恢复后自动同步

### 6.3 安全要求
- GPS防作弊检测
- 数据传输加密
- 敏感操作需认证

### 6.4 兼容性
- iOS 15.0+
- 支持iPhone全系列

---

## 7. 技术架构

### 7.1 技术栈
| 层级 | 技术选型 |
|------|----------|
| 前端 | SwiftUI |
| 地图 | Apple MapKit |
| 后端 | Supabase |
| 数据库 | PostgreSQL + PostGIS |
| 实时通讯 | Supabase Realtime |
| 支付 | StoreKit 2 |
| 认证 | Supabase Auth |

### 7.2 核心代码模块
| 功能 | 文件 |
|------|------|
| 登录认证 | AuthManager.swift |
| 位置管理 | LocationManager.swift |
| 领地管理 | TerritoryManager.swift |
| POI管理 | POIManager.swift |
| 探索管理 | ExplorationManager.swift |
| 物品管理 | ItemManager.swift |
| 建造管理 | BuildingManager.swift |
| 交易管理 | TradeManager.swift |
| 收音机 | RadioManager.swift |
| 通讯管理 | CommunicationManager.swift |
| 频道管理 | ChannelManager.swift |
| 内购管理 | StoreKitManager.swift |
| 排行榜 | LeaderboardManager.swift |
| 成就系统 | AchievementManager.swift |
| 生存体征 | VitalSignsManagerV2.swift |

---

## 8. 项目里程碑

| 阶段 | 功能范围 |
|------|----------|
| MVP | 登录 + 圈地 + POI探索 + 背包 |
| V1.0 | 建造 + 交易 + 基础通讯 |
| V1.5 | 完整通讯 + 排行榜 + 成就 |
| V2.0 | 付费系统 + 多语言 + 优化 |

---

## 9. 风险与对策

| 风险 | 对策 |
|------|------|
| GPS耗电量大 | 后台智能降频、电池优化提示 |
| 作弊刷资源 | GPS轨迹分析、速度检测 |
| 用户留存低 | 成就引导、每日任务、社交绑定 |
| 变现困难 | 优化付费点设计、A/B测试定价 |

---

## 附录：术语表

| 术语 | 解释 |
|------|------|
| LBS | Location Based Service，基于位置的服务 |
| POI | Point of Interest，兴趣点 |
| PTT | Push to Talk，按键说话 |
| OAuth | 第三方授权登录协议 |
| PostGIS | PostgreSQL的地理空间扩展 |
