# 游戏设计文档 (GDD)
## 地球新主 - EarthLord

---

## 1. 游戏概述

### 1.1 一句话描述
> **用双脚丈量废土，在现实世界中重建末日后的新文明**

### 1.2 游戏类型
- **主类型**: LBS（Location Based Service）生存游戏
- **子类型**: 领地经营 + 资源管理 + 社交
- **平台**: iOS

### 1.3 核心体验
玩家扮演末日后的幸存者，在真实世界中行走探索，通过GPS圈定领地、搜刮废墟获得资源、建造设施重建家园，并与其他玩家进行交易和社交互动。

### 1.4 设计理念
**"Hope Punk"（希望朋克）**
- 不是绝望的末日，而是重建的希望
- 废土之上，绿色植物破土而出
- 破败的建筑上，新生的标志闪闪发光
- 在废墟中发现美好，在协作中重建文明

### 1.5 独特卖点 (USP)
1. **真实行走圈地** - 用脚步在现实世界画出自己的领地
2. **Walk to Earn** - 行走获得游戏奖励，促进健康
3. **真实POI映射** - 现实中的医院、超市对应游戏中的资源点
4. **以物易物** - 无货币的末日经济系统
5. **基于位置的社交** - 附近的玩家才能交易和通讯

---

## 2. 世界观与叙事

### 2.1 背景故事

**时间线**:

| 年份 | 事件 |
|------|------|
| 2048年 | "世界战争"爆发，全球文明在72小时内崩塌，99%人口消失 |
| 2051年 | 幸存者从废墟中走出，《新开拓者协议》颁布 |
| 现在 | 玩家作为新一代开拓者，重建文明 |

### 2.2 核心法则
> **《新开拓者协议》**
>
> "凡以双足丈量之无主土地，皆为开拓者所有。"

这条法则奠定了游戏的核心玩法基础：
- 旧世界的土地所有权已失效
- 只有亲自走过的土地才能拥有
- 用脚步丈量，用双手建设

### 2.3 世界设定

**物理规则**:
- 卫星系统部分恢复，支持GPS定位
- 电力稀缺，需要自己发电
- 物资分散在城市各处的废墟中
- 以物易物是主要交易方式

**社会规则**:
- 无中央政府，开拓者自治
- 协议鼓励合作，但竞争同样存在
- 领地神圣不可侵犯
- 通讯能力代表影响力

### 2.4 角色设定

**玩家角色**: 开拓者（Settler）
- 身份：末日后的幸存者
- 目标：重建家园，发展壮大
- 成长路线：装备升级、领地扩张、社会影响力提升

**NPC角色**（系统）:
- 《新开拓者协议》广播 - 引导和公告
- 系统终端 - 任务和成就

---

## 3. 核心玩法循环

### 3.1 主循环图

```
┌─────────────────────────────────────────────────────────────┐
│                      核心游戏循环                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   登录注册 → 圈地占领 → 探索搜刮 → 获得资源                   │
│      ↑                              ↓                       │
│      │         ┌──────────────────────────────┐            │
│      │         │  资源用途：                    │            │
│      │         │  • 建造建筑（消耗资源）         │            │
│      │         │  • 交易换物（流通资源）         │            │
│      │         │  • 生存消耗（食物/水）          │            │
│      │         └──────────────────────────────┘            │
│      │                              ↓                       │
│      └──────── 通讯社交 ← 成就排行 ← 发展壮大               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 游戏节奏

**单日循环（Daily Loop）**:
1. 查看生存体征状态
2. 外出探索获取资源
3. 返回领地建设或升级
4. 与附近玩家交易互动
5. 查看排行和成就进度

**长期循环（Meta Loop）**:
1. 扩张领地规模
2. 升级通讯设备
3. 解锁高级建筑
4. 提升排行榜排名
5. 收集稀有成就

### 3.3 玩家动机分析

| 动机类型 | 游戏满足方式 |
|----------|--------------|
| 成就感 | 领地扩张、建筑升级、成就解锁 |
| 竞争欲 | 排行榜、领地面积对比 |
| 社交需求 | 频道聊天、玩家交易 |
| 收集欲 | 物资收集、成就徽章 |
| 探索欲 | 新POI发现、区域探索 |
| 健康需求 | Walk to Earn机制 |

---

## 4. 游戏系统设计

### 4.1 圈地系统

#### 4.1.1 机制描述
玩家在现实中行走，GPS记录轨迹，当形成闭合多边形时，圈内区域成为玩家领地。

#### 4.1.2 操作流程
```
1. 点击"开始圈地"
2. 玩家开始行走
3. 蓝色轨迹线实时绘制
4. 返回起点10米范围内
5. 线条自动闭合成多边形
6. 系统验证合法性
7. 确认后领地归属玩家
```

#### 4.1.3 设计参数
| 参数 | 值 | 设计理由 |
|------|-----|----------|
| 最小面积 | 100m² | 防止刷小块领地 |
| 闭合容差 | 10m | 平衡易用性和精度 |
| GPS采样频率 | 1次/秒 | 平衡精度和电量 |

#### 4.1.4 防作弊机制
- 速度检测：超过人类正常行走速度拒绝
- 轨迹分析：检测非自然移动模式
- 位置跳跃检测：突然大距离移动拒绝

---

### 4.2 探索与资源系统

#### 4.2.1 POI（兴趣点）系统

**POI分类与产出**:
| POI类型 | 图标 | 资源类型 | 基础产出量 |
|---------|------|----------|------------|
| 医院/诊所 | 🏥 | 医疗物资 | 8-15 |
| 药店 | 💊 | 药品 | 5-10 |
| 超市 | 🏪 | 食物/水 | 10-20 |
| 餐厅 | 🍽️ | 食物 | 5-12 |
| 工厂 | 🏭 | 金属材料 | 8-18 |
| 工地 | 🚧 | 建材 | 10-20 |
| 公园 | 🌳 | 木材 | 6-12 |
| 银行 | 🏦 | 稀有材料 | 2-5 |
| 珠宝店 | 💎 | 稀有材料 | 3-8 |

**搜刮机制**:
- 进入POI范围50米内触发发现
- 点击"搜刮"消耗行动力
- 根据POI类型随机产出资源
- 同一POI有冷却时间（CD）

#### 4.2.2 资源分类

**基础资源**:
| 资源 | 用途 | 获取方式 |
|------|------|----------|
| 木材 | 基础建造 | 公园、林地 |
| 石头 | 基础建造 | 工地、采石场 |
| 金属 | 高级建造 | 工厂、废车场 |
| 布料 | 庇护所 | 服装店、超市 |

**生存资源**:
| 资源 | 用途 | 获取方式 |
|------|------|----------|
| 罐头食品 | 恢复饱食度 | 超市、餐厅 |
| 饮用水 | 恢复水分 | 超市、便利店 |
| 药品 | 恢复生命 | 医院、药店 |

**稀有资源**:
| 资源 | 用途 | 获取方式 |
|------|------|----------|
| 电子元件 | 高级设备 | 电器店 |
| 卫星模块 | 卫星通讯 | 稀有掉落 |
| 太阳能电池 | 能源设施 | 专门POI |

---

### 4.3 建造系统

#### 4.3.1 建筑分类与作用

**Tier 1 - 生存基础**:
| 建筑 | 材料消耗 | 功能 |
|------|----------|------|
| 篝火 | 石头×20, 木材×30 | 取暖、照明 |
| 简易帐篷 | 布料×15, 木材×20 | 休息恢复 |
| 储水桶 | 金属×10, 木材×5 | 存储水资源 |

**Tier 2 - 功能扩展**:
| 建筑 | 材料消耗 | 功能 |
|------|----------|------|
| 小仓库 | 木材×50, 金属×20 | 扩展背包+20 |
| 工作台 | 木材×30, 金属×40 | 解锁制作 |
| 农田 | 木材×20, 石头×30 | 生产食物 |
| 水井 | 石头×50, 金属×15 | 生产水 |

**Tier 3 - 高级设施**:
| 建筑 | 材料消耗 | 功能 |
|------|----------|------|
| 中仓库 | 金属×80, 电子×10 | 扩展背包+50 |
| 太阳能板 | 电子×30, 玻璃×20 | 提供电力 |
| 风力发电 | 金属×60, 电子×20 | 提供电力 |
| 营地电台 | 电子×50, 卫星×1 | 扩大通讯范围 |

#### 4.3.2 建筑状态机

```
     [建造中]
         ↓ 时间到
    [待激活]
         ↓ 激活操作
     [运行中] ←───────┐
    ↙    ↘           │
[损坏]    [升级中]    │
   ↓         ↓       │
[维修] → [完成] ──────┘
```

**状态说明**:
| 状态 | 可用操作 | 触发条件 |
|------|----------|----------|
| 建造中 | 查看进度 | 开始建造 |
| 待激活 | 激活 | 建造完成 |
| 运行中 | 升级、停用、使用 | 激活后 |
| 损坏 | 维修 | 缺乏维护或攻击 |
| 升级中 | 查看进度 | 开始升级 |

---

### 4.4 交易系统

#### 4.4.1 交易模式
**以物易物制**：没有货币，只有物品交换

#### 4.4.2 交易流程
```
发布方:
1. 进入交易界面
2. 选择"我提供"的物品
3. 选择"我需要"的物品
4. 发布挂单

接收方:
1. 进入对方领地100米范围
2. 看到挂单列表
3. 选择感兴趣的交易
4. 确认接受
5. 双方物品自动交换
```

#### 4.4.3 设计理由
- **100米范围限制**：鼓励真实移动，增强线下社交可能
- **以物易物**：符合末日世界观，增加策略深度
- **挂单制**：异步交易，玩家不必同时在线

---

### 4.5 生存体征系统

#### 4.5.1 体征指标

| 指标 | 最大值 | 衰减速度 | 临界值 | 惩罚 |
|------|--------|----------|--------|------|
| 核心生命 | 100 | 依赖其他指标 | 0 | 死亡 |
| 饱食度 | 100% | -5%/小时 | 20% | 每分钟-1生命 |
| 水分 | 100% | -10%/小时 | 20% | 每分钟-2生命 |

#### 4.5.2 增益机制
| 条件 | 增益效果 |
|------|----------|
| 饱食度 > 80% | 探索效率+10% |
| 水分 > 80% | 移动速度+5% |
| 双满 > 80% | 资源获取+15% |

#### 4.5.3 恢复方式
| 消耗品 | 恢复效果 |
|--------|----------|
| 罐头食品 | 饱食度+30% |
| 压缩饼干 | 饱食度+15% |
| 饮用水 | 水分+40% |
| 果汁 | 水分+25%, 饱食度+5% |
| 急救包 | 生命+20 |
| 药品 | 生命+10 |

#### 4.5.4 设计意图
- 创造资源消耗出口，形成持续需求
- 增加紧迫感，促进活跃度
- 提供付费点（减缓衰减道具）

---

### 4.6 通讯系统

#### 4.6.1 设备等级与能力

| 等级 | 设备 | 接收 | 发送 | 范围 | 获取方式 |
|------|------|------|------|------|----------|
| Lv.1 | 收音机 | ✓ | ✗ | - | 初始 |
| Lv.2 | 对讲机 | ✓ | ✓ | 3km | 资源制作 |
| Lv.3 | 营地电台 | ✓ | ✓ | 10km | 建造 |
| Lv.4 | 卫星通讯 | ✓ | ✓ | 全球 | 付费/稀有资源 |

#### 4.6.2 频道系统

**公共频道**:
- 全服玩家可见（受设备范围限制）
- 用于公告、求助、闲聊

**私人频道**:
- 玩家自建
- 设置加入条件
- 类似微信群

**PTT呼叫**:
- 模拟真实对讲机
- 长按说话，松开发送
- 增强沉浸感

---

### 4.7 成就系统

#### 4.7.1 成就分类

**新手成就**（引导类）:
| 成就 | 条件 | 奖励 |
|------|------|------|
| 初来乍到 | 完成注册 | 100金币 |
| 新手领主 | 圈下第一块地 | 200金币 |
| 末世拾荒者 | 完成第一次搜刮 | 150金币 |
| 建筑大师 | 建造第一个建筑 | 200金币 |

**进阶成就**（挑战类）:
| 成就 | 条件 | 奖励 |
|------|------|------|
| 地产大亨 | 累计圈地10000m² | 500金币 |
| 探索先锋 | 探索100个POI | 500金币 |
| 交易达人 | 完成50笔交易 | 400金币 |

**稀有成就**（荣誉类）:
| 成就 | 条件 | 奖励 |
|------|------|------|
| 万亩领主 | 累计圈地100000m² | 传说徽章 |
| 全服首富 | 登上面积榜第一 | 传说徽章 |
| 社交蝴蝶 | 与100名玩家交易 | 史诗徽章 |

#### 4.7.2 稀有度设计
| 稀有度 | 颜色 | 完成难度 |
|--------|------|----------|
| 普通 | 灰色 | 日常完成 |
| 稀有 | 蓝色 | 周级挑战 |
| 史诗 | 紫色 | 月级挑战 |
| 传说 | 金色 | 长期目标 |

---

### 4.8 排行榜系统

#### 4.8.1 榜单类型
| 榜单 | 排名依据 | 刷新频率 |
|------|----------|----------|
| 领地面积榜 | 总领地面积 | 5分钟 |
| 探索废墟榜 | 累计探索POI数 | 5分钟 |
| 建筑数量榜 | 建筑总数 | 5分钟 |

#### 4.8.2 展示信息
- 前100名完整列表
- 自己的排名和分数
- 与上一名的差距

---

## 5. 数值设计

### 5.1 经济平衡

#### 5.1.1 资源产出（每小时）
| 活动 | 预期产出 |
|------|----------|
| 探索（步行1km） | 50-80资源单位 |
| 农田（Tier2） | 10资源/小时 |
| 交易获得 | 变动 |

#### 5.1.2 资源消耗
| 用途 | 消耗量 |
|------|--------|
| 生存体征维护 | ~20资源/天 |
| Tier1建筑 | 50-80资源 |
| Tier2建筑 | 100-200资源 |
| Tier3建筑 | 300-500资源 |

#### 5.1.3 平衡目标
- 每日1小时探索可维持生存
- 每日2小时探索可稳定发展
- 氪金可加速但非必须

### 5.2 时间设计

| 系统 | 时间参数 |
|------|----------|
| POI冷却 | 4小时 |
| 建造时间（Tier1） | 10分钟 |
| 建造时间（Tier2） | 30分钟-2小时 |
| 建造时间（Tier3） | 4-12小时 |
| 体征衰减 | 实时 |

---

## 6. 界面与交互设计

### 6.1 主界面布局

```
┌────────────────────────────────────┐
│            [状态栏]                 │
│  ❤️ 69/100  🍖 68%  💧 70%          │
├────────────────────────────────────┤
│                                    │
│                                    │
│           [地图区域]                │
│         显示卫星地图                │
│         显示玩家位置                │
│         显示POI标记                 │
│         显示领地边界                │
│                                    │
│                                    │
├────────────────────────────────────┤
│    [开始圈地]    [探索搜刮]         │
├────────────────────────────────────┤
│  🗺️     📦      🔨     📻     👤   │
│ 地图   背包    建造   通讯   个人   │
└────────────────────────────────────┘
```

### 6.2 视觉风格

**主色调**:
| 元素 | 颜色 | 含义 |
|------|------|------|
| 主色 | 暗绿色 #2D5016 | 希望、新生 |
| 辅色 | 锈橙色 #8B4513 | 废土、金属 |
| 强调 | 亮绿色 #7CFC00 | 生机、活力 |
| 背景 | 深灰色 #1A1A1A | 废墟、夜晚 |

**UI风格**:
- 做旧金属质感边框
- 手写体/打字机字体
- 扫描线/信号干扰效果
- 霓虹发光文字

**地图风格**:
- 卫星地图底图
- 领地边界绿色发光描边
- POI使用图标+脉冲动画
- 玩家位置蓝色光点

### 6.3 音效设计

| 场景 | 音效类型 |
|------|----------|
| 背景音乐 | 低沉电子环境音 + 希望感旋律 |
| 圈地成功 | 确认音 + 欢呼音效 |
| 发现POI | 雷达ping音 |
| 搜刮成功 | 金属碰撞 + 收集音 |
| 建造完成 | 锤击声 + 完成音 |
| 通讯 | 无线电静电声 |
| 危险提示 | 警报声 |

---

## 7. 玩家旅程

### 7.1 新手引导流程（前30分钟）

**阶段1：觉醒（0-5分钟）**
1. 过场动画：末日背景介绍
2. 创建身份（登录）
3. 收到第一条广播："欢迎，新开拓者..."

**阶段2：第一块地（5-15分钟）**
1. 教学：如何开始圈地
2. 引导玩家走出一个小圈（≈200m²）
3. 圈地成功，获得成就"新手领主"

**阶段3：第一次搜刮（15-25分钟）**
1. 地图显示附近POI
2. 引导前往最近的POI
3. 完成搜刮，获得成就"末世拾荒者"

**阶段4：第一个建筑（25-30分钟）**
1. 资源足够，提示可建造
2. 引导建造篝火
3. 建造成功，完成新手教程

### 7.2 日常体验流程

**早间**:
- 查看体征状态
- 领取每日任务
- 规划今日探索路线

**通勤/散步时**:
- 开启探索模式
- 经过POI自动发现
- 搜刮收集资源

**休息时**:
- 查看背包整理资源
- 规划建造升级
- 浏览交易市场

**晚间**:
- 查看排行榜
- 完成每日任务
- 领取成就奖励

---

## 8. 商业化设计

### 8.1 变现模型

**订阅制（主要收入）**:
| 方案 | 价格 | 核心权益 |
|------|------|----------|
| 开拓者月卡 | $9.99/月 | 探索范围+50%，每日奖励 |
| 领主通行证 | $19.99/月 | 全部特权，专属皮肤 |

**一次性购买（辅助收入）**:
| 商品 | 价格 | 内容 |
|------|------|------|
| 初级物资包 | $0.99 | 基础资源×100 |
| 中级物资包 | $2.99 | 混合资源×300 |
| 稀有资源包 | $9.99 | 稀有材料×50 |
| 设备升级包 | $4.99 | 直升一级通讯设备 |

### 8.2 付费点设计原则
1. **付费不破坏平衡** - 氪金加速但不压倒
2. **免费玩家可玩** - 核心内容免费可达
3. **付费有感知价值** - 订阅权益明显
4. **避免Pay to Win** - 排行榜不受付费直接影响

### 8.3 留存设计

**每日登录**:
- 每日签到奖励
- 连续登录加成

**周期性活动**:
- 周末双倍探索奖励
- 月度排行榜赛季

**社交绑定**:
- 频道社交
- 交易依赖

---

## 9. 技术实现概要

### 9.1 核心技术栈
| 层级 | 技术 |
|------|------|
| 前端 | SwiftUI (iOS原生) |
| 地图 | Apple MapKit |
| 后端 | Supabase |
| 数据库 | PostgreSQL + PostGIS |
| 实时通讯 | Supabase Realtime |
| 支付 | StoreKit 2 |

### 9.2 关键技术点

**GPS圈地**:
- CoreLocation持续定位
- 多边形面积计算
- PostGIS空间查询（重叠检测）

**POI发现**:
- MapKit POI搜索
- 地理围栏（Geofencing）
- 后台位置更新

**实时通讯**:
- Supabase Realtime订阅
- 推送通知
- 消息持久化

---

## 10. 附录

### 10.1 术语表

| 术语 | 解释 |
|------|------|
| 开拓者 | 玩家角色称呼 |
| 领地 | 玩家通过圈地获得的区域 |
| POI | Point of Interest，可搜刮的兴趣点 |
| 体征 | 角色的生存状态（生命/饱食/水分） |
| PTT | Push to Talk，按住说话 |
| Walk to Earn | 通过行走获得游戏奖励 |

### 10.2 代码文件对照

| 系统 | 核心文件 |
|------|----------|
| 认证 | AuthManager.swift |
| 位置 | LocationManager.swift |
| 领地 | TerritoryManager.swift |
| POI | POIManager.swift |
| 探索 | ExplorationManager.swift |
| 物品 | ItemManager.swift |
| 建造 | BuildingManager.swift |
| 交易 | TradeManager.swift |
| 收音机 | RadioManager.swift |
| 通讯 | CommunicationManager.swift |
| 频道 | ChannelManager.swift |
| 内购 | StoreKitManager.swift |
| 排行榜 | LeaderboardManager.swift |
| 成就 | AchievementManager.swift |
| 体征 | VitalSignsManagerV2.swift |

---

## 版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| v1.0 | 2025-12-27 | 初版创建 |
